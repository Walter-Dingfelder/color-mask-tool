<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Color Mask Tool</title>
  <style>
    body, html { margin:0; padding:0; overflow:hidden; }
    canvas { display:block; }
  </style>
</head>
<body>
<canvas id="maskCanvas"></canvas>
<script>
  async function applyMask(imageUrl) {
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.src = imageUrl;
    await img.decode();

    const canvas = document.getElementById('maskCanvas');
    canvas.width = img.width;
    canvas.height = img.height;
    const ctx = canvas.getContext('2d');

    ctx.drawImage(img, 0, 0);
    // Draw opaque white over areas outside the label-cutout (update shape as needed):
    ctx.globalCompositeOperation = 'destination-out';
    ctx.fillStyle = 'white';
    ctx.beginPath();
    // Example: circular center mask — you’ll replace this polygon with your actual shape
    const cx = img.width * 0.5;
    const cy = img.height * 0.5;
    const r = Math.min(cx, cy)*0.75;
    ctx.arc(cx, cy, r, 0, 2*Math.PI);
    ctx.fill();

    const maskedData = canvas.toDataURL('image/png');

    window.parent.postMessage({ maskedData }, '*');
  }

  const params = new URLSearchParams(window.location.search);
  const imageUrl = params.get('imageUrl');
  if (imageUrl) applyMask(imageUrl);
</script>
</body>
</html>
